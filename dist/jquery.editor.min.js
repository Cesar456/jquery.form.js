(function(t){function e(){void 0!==window.console&&void 0!==window.console.log&&("function"==typeof window.console.log?window.console.log.apply(window.console,arguments):window.console.log(Array.prototype.slice.call(arguments)))}function a(){function t(t){if("string"==typeof t)return"<span class='tool'>"+t.replace(" ","&nbsp;")+"</span>";if(t.options){var e=[];e.push('<option value="" disabled selected style="display:none;">'+t.label.replace(" ","&nbsp;")+"</option>");for(var a in t.options)if(t.options.hasOwnProperty(a)){var i=t.options[a];"string"==typeof i&&(i={value:i,label:i}),e.push('<option value="'+i.value+'">'+i.label+"</option>")}return'<select data-cmd="'+t.cmd+'" title="'+t.desc+'">'+e.join("")+"</select>"}return'<button data-cmd="'+t.cmd+'" title="'+t.desc+'" '+(t.toggle?'data-toggle="'+t.toggle+'" data-label="'+t.label+'"':"")+">"+t.label+"</button>"}var e,a=[{cmd:"editor",desc:"Switch between source and editor",label:"&#x25c7;",toggle:"&#x270e;"}," ",{cmd:"bold",desc:"Make the Selected text bold",label:"<b>B</b>"},{cmd:"italic",desc:"Make the Selected text Italic",label:"<i>I</i>"},{cmd:"underline",desc:"Underline the selected text",label:"<u>U</u>"},{cmd:"strikethrough",desc:"Strike through the selected text",label:"<strike>S</strike>"}," ",{cmd:"createlink",desc:"Create Link",label:"&#x26ad;"},{cmd:"insertimage",desc:"Insert file or image",label:"&#x2b15;"}," ",{cmd:"insertorderedlist",desc:"Insert Numbered list",label:"&#x2631;"},{cmd:"insertunorderedlist",desc:"Insert Bullet list",label:"&#x25a4;"}," ",{cmd:"indent",desc:"Indent",label:"&#x25bb;"},{cmd:"outdent",desc:"Outdent",label:"&#x25c5;"}," ",{cmd:"justifyleft",desc:"Align Left",label:"&#x25f0;"},{cmd:"justifycenter",desc:"Align center",label:"&#x2637;"},{cmd:"justifyright",desc:"Align right",label:"&#x25f3;"},{cmd:"justifyfull",desc:"Jusitfy",label:"&#x2630;"}," ",{label:" Format",cmd:"formatblock",desc:"Format selected text",options:[{value:"p",desc:"Normal",label:"Normal"},{value:"h1",desc:"Heading 1",label:"<h1>Heading 1</h1>"},{value:"h2",desc:"Heading 2",label:"<h2>Heading 2</h2>"},{value:"h3",desc:"Heading 3",label:"<h3>Heading 3</h3>"},{value:"h4",desc:"Heading 4",label:"<h4>Heading 4</h4>"},{value:"pre",desc:"Formatted",label:"<pre>Formatted</pre>"},{value:"address",desc:"Address",label:"<address>Address</address>"},{value:"blockquote",desc:"Blockquote",label:"<blockquote>Blockquote</blockquote>"},{value:"div",desc:"Normal Div",label:"Normal (Div)"}]}," ",{cmd:"inserthtml",desc:"Insert Special Character or Symbol",label:" Symbol",options:["$","&pound;","&euro;","&yen;","&copy;","&trade;","&reg;","&aacute;","&acirc;","&aelig;","&agrave;","&aring;","&atilde;","&auml;","&eacute;","&ecirc;","&egrave;","&eth;","&euml;","&iacute;","&icirc;","&iexcl;","&igrave;","&iuml;","&ntilde;","&oacute;","&ocirc;","&oelig;","&ograve;","&otilde;","&ouml;","&szlig;","&uacute;","&ucirc;","&ugrave;","&uuml;","&yacute;","&yuml;","&frac12;","&frac14;","&frac34;","&times;","&divide;","&lt;","&gt;","&deg;","&circ;","&plusmn;","&sum;","&radic;","&infin;","&ne;","&le;","&ge;","&asymp;","&hellip;","&iquest;"]}," ",{label:" Font",cmd:"fontname",desc:"Apply font to selected text",options:[{value:"Times",label:'<span style="font-family:times">Times</span>'},{value:"Helvetica",label:'<span style="font-family:Helvetica">Helvetica</span>'},{value:"Arial",label:'<span style="font-family:Arial">Arial</span>'},{value:"Tahoma",label:'<span style="font-family:Tahoma">Tahoma</span>'},{value:"Courier",label:'<span style="font-family:Courier">Courier</span>'},{value:"Western",label:'<span style="font-family:Western">Western</span>'},{value:"serif",label:'<span style="font-family:serif">Serif</span>'},{value:"sans-serif",label:'<span style="font-family:sans-serif">sans-serif</span>'},{value:"fantasy",label:'<span style="font-family:fantasy">fantasy</span>'},{value:"monospace",label:'<span style="font-family:monospace">monospace</span>'},{value:"Verdana",label:'<span style="font-family:Verdana">Verdana</span>'}]},{cmd:"removeformat",desc:"Remove Formatting",label:'<b style="color:red;">X</b>'}],i="";for(e=0;a.length>e;e++)i+=t(a[e]);return i}function i(a,i){var n,r=t(document).selectedText();if(("insertimage"===a||"createlink"===a)&&("A"===r.obj.tagName&&(n=r.obj.href),"IMG"===r.obj.tagName&&(n=r.obj.src)),"createlink"===a){var l=r.obj&&"tagName"in r.obj&&"A"===r.obj.tagName.toUpperCase()?r.obj.href:r.text.match("^https?://")?r.text:"http://";if(i=window.prompt("URL of a Link?",l),!i)return;if(!r.text.length){if((r.text=window.prompt("What is the text you'd like to display on the link?"))||(r.text=i),null===r.text)return!1;i="<a href='"+i+"'>"+r.text+"</a>",a="inserthtml"}}"formatblock"==a&&t.browser.msie&&(i="<"+i+">");try{e([window,a,i]),document.execCommand(a,!1,i)}catch(o){if(document.selection){var s=document.selection.createRange();if(s.pasteHTML)return s.pasteHTML(i),!1}e("Could not execute "+a)}if(r&&r.obj){var c="[contenteditable]",d=t(r.obj);(d.is(c)?d:d.parents(c)).trigger("change")}return!1}function n(a){var n="data:image/gif;base64,R0lGODlhEAAQAOUdAOvr69HR0cHBwby8vOzs7PHx8ff397W1tbOzs+Xl5ebm5vDw8PPz88PDw7e3t+3t7dvb2+7u7vX19eTk5OPj4+rq6tbW1unp6bu7u+fn5+jo6N/f3+/v7/7+/ra2ttXV1f39/fz8/Li4uMXFxfb29vLy8vr6+sLCwtPT0/j4+PT09MDAwL+/v7m5ubS0tM7OzsrKytra2tTU1MfHx+Li4tDQ0M/Pz9nZ2b6+vgAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFMAA5ACwAAAAAEAAQAAAGg8CcMAcICAY5QsEwHBYPCMQhl6guGM5GNOqgVhMPbA6y5Xq/kZwkN3Fsu98EJcdYKCo5i7kKwCorVRd4GAg5GVgAfBpxaRtsZwkaiwpfD0NxkYl8QngARF8AdhmeDwl4pngUCQsVHDl2m2iveDkXcZ6YTgS3kAS0RKWxVQ+/TqydrE1BACH5BAkwADkALAAAAAAQABAAAAZ+wJwwJ1kQIgNBgDMcdh6KRILgQSAOn46TIJVSrdZGSMjpeqtgREAoYWi6BFF6xCAJS6ZyYhEIUwxNQgYkFxwBByh2gU0kKRVHi4sgOQuRTRJtJgwSBJElihwMQioqGmw5gEMLKk2AEkSBq4ElQmNNoYG2OVpDuE6Lrzmfp0NBACH5BAUwADkALAAAAAAQABAAAAaFwJwwJ1kQCDlCwTAcMh6KhDQnVSwYTkJ1un1gc5wtdxsh5iqaLbVKyVEWigq4ugZgTyiA9CK/JHIZWCsICCxpVWV/EzkHhAgth1UPQ4OOLXpScmebFA6ELHAZclBycXIULi8VZXCZawplFG05flWlakIVWravCgSaZ1CuksBDFQsAcsfFQQAh+QQJMAA5ACwAAAAAEAAQAAAGQcCccEgsGo/IpHLJzDGaOcKCCUgkAEuFNaFRbq1dJCxX2WKRCFdMmJiiEQjRp1BJwu8y5R3RWNsRBx9+SSsxgzlBACH5BAkwADkALAAAAAAQABAAAAaJwJwwJ1kQCDlCwTAcMh6KhDQnVSwYTkJ1un1gc5wtdxsh5iqaLbVKyTEWigq4ugZglRXpRX5J5DJYAFIAaVVlfhNrURqFVQ9DYhqCgzkzCGdnVQBwGRU0LQiXCRUAORQJCwAcOTChoYplBXIKLq6vUXRCCQ22olUEcroJB66KD8FNCjUrlxWpTUEAIfkEBTAAOQAsAAAAABAAEAAABobAnDAnWRAIOULBMBwyHoqENCdVLBhOQnW6fWBznC13G8nZchXNllql5Bg2xA1cZQOwShwCMdDkLgk5GVgAUgAie3syVDkTbFIaiIkIJ0NiGnp7HiNonRVVAHEuFjlQFVQVAI0JCzYjrKCPZQWnf1unYkMVWrFbBLVoUIaPD8C6CwCnAMhNQQA7",r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAADAUlEQVQ4jY2UTWxUVRiGn3PvnR/m//cW2iEzTC8jtE1tIbQFHKHOaBMWMG2wwUYxMSYEorWEyMIFhrjThZKIIdFEbWKirIw7V4bEEE10UROsDIptgm7GnylVOvbOvZ+LQSPITPiS72zOc5685+Scg4jQrgFjZGTkacuyHu/EiQgGHcqyrF3ZbPqEptlrsVjs63q9fr0t3CFN/OjRyRtffDkvb51/QUrF4iVAb8u3myiXH3ll/r2zIu5XIu5FmTk8IKOje55qx2v3SmmaplV4oGdu3/gu3p0/z8effMTx2TE8WvOsUip231ubmjrw4eeX35T3PzgpoEk47JXF747JmdMPysTExBv3lSifzz+8zeqe3juWw+u9gUclKBQyePUGs6cKrDUWj2UymcLd6+4QKaWMoaH+1584slPBNxR6m/j9QiAYJBKuk0zBocmo38r1v9xRNF566MTuYn7HwJCAfEt3WhGN6oRiNomEDfIHzz6TxR+4OjM4OFi+pygSiaS2ZFNnjkwPg3wPrJNMGSTjOpvSDTTdAcchEnQ4PruR2Ib0OdMMbfyfqFjcd6q0P5fc3P0DTZYBG8N7iy7TpifhARQoBbgcOpAgX1jsG+gbm7lDZJrmVisfev5gpRvkCobbAPcvFE3mXrKYfHITICC3G2HudC/2rdpzSqn4v6LintFXKwezwVDwR0QaLVhzqNfXufDaEm+f+wmnqRCNVjIXhvpT7C/d3FKpHL4AoBUKfY8OD3sr46UGsIRSAroDgN1UrKyaROKb0XVQmmqJNAHWOPniVn6rX5mytls7jZ6urtLvK1VW/2wi7jrKVYgSQOHz67xzMY03IKys2oiAchUoAT/cbAgr9SVjW2+5rCzL2hGLez/1+X5N+ZQPgwB4bMRtnYXHABGFI+qft9AaFfxSc4iFepery1cfUyJCLpfbPrp397TH5wkbGDgizbsv3H9LHMcNB6PRa9cWLy8sLHxWq9V+Vre/DJLJZCYQCGwAxLZtp5NIKSWRSCRarVavi8gqwN+3R5ghnBdykAAAAABJRU5ErkJggg==";i("insertimage",n);var l=t(window).selectedText(),o=new FileReader;o.onload=function(){var a=new Image,i=document.createElement("canvas"),s=i.getContext("2d"),c=1e3,d=1e3;a.onload=function(){var r=1;a.width>c&&(r=c/a.width),a.height>d&&(r=Math.min(d/a.height,r)),i.width=a.width*r,i.height=a.height*r,s.drawImage(a,0,0,i.width,i.height);var h=i.toDataURL();e("CANVAS LENGTH"+i.toDataURL().length),t(l.obj).find("img").filter(function(){return t(this).attr("src")===n}).eq(0).attr("src",h.length<o.result.length?h:o.result)},a.onerror=function(){t(l.obj).find("img").filter(function(){return t(this).attr("src")===n}).eq(0).attr({src:r,title:"Failed to insert image"})},a.src=o.result},o.readAsDataURL(a)}function r(t){var e;if(!("FileReader"in window))return!1;if(t.files&&t.files.length)for(e=0;t.files.length>e;e++)n(t.files[e]);else{if(!t.items||!t.items.length)return!1;for(e=0;t.items.length>e;e++)if("file"===t.items[e].kind&&t.items[e].type.match(/^image/))n(t.items[e].getAsFile());else if("string"===t.items[e].kind)return!1}return!0}function l(a){a.preventDefault(),a.stopPropagation();try{var n=t("[contenteditable]").get(0);n.focus();var l=n.document,o=l.selection.createRange().duplicate().getBoundingClientRect();o.left>=0&&o.top>=0||l.body.createTextRange().moveToPoint(n.posx,n.posy).select()}catch(c){}var d=t(this).attr("data-cmd");if("editor"!==d){if("insertimage"===d){var h=t(this).siblings("input[type=file]").filter(function(){return""===t(this).val()});return 0===h.length&&(h=t("<input type='file' style='opacity:0;position:absolute;left:-2000px' multiple='true'/>").change(function(){r(this)}).insertAfter(this)),h.trigger("focus").trigger("click"),!1}if(!d)return e("ERROR, no command passed to function"),!1;t(this).toggleClass("selected");try{i(d,null,this)}catch(a){e("Uncaught error applying insert",a)}return!1}t(this).toggleClass("selected").each(function(){t(this).siblings("button,select").attr("disabled",t(this).is(".selected")?"disabled":!1)}).filter("[data-toggle]").each(function(){t(this).html(t(this).is(".selected")?t(this).attr("data-toggle"):t(this).attr("data-label"))});var u=t(this).parents(s).nextAll("[contenteditable]:lt(1),textarea[type=html]:lt(1)");if(2===u.length){var f=u.filter(":visible");u.show().filter(f).hide()}else{var p=t(window).selectedText(),g=t(),m="[contenteditable]";if(p)g=t(p.obj);else if(g=t(this).parents("div.toolbar").next("textarea"),g.is(":visible")||(g=g.next("[contenteditable]:visible")),0===g.length)return e("can't find an element to switch"),!1;g.is("textarea[type=html]")?g.hide().next(m).show():(g.is(m)?g:g.parents(m)).hide().prev("textarea").show().focus()}}function o(){try{i(t(this).attr("data-cmd"),this.options[this.selectedIndex].value)}catch(a){e("Uncaught error applying insert",a)}}t.make=function(e){var a={};return e=e.replace(/([\.\#]|\[[a-z]+(\=|\])?)?([a-z0-9\_]*)\]?/gi,function(t,e,i,n){return"."===e?a["class"]=n:"#"===e?a.id=n:e&&(a[e.replace(/[^a-z]/gi,"").toLowerCase()]=n),""}),t("<"+(e||"div")+">").attr(a)};var s="div.toolbar";t.fn.selectedText=function(){var t;return this.each(function(){var a=null,i=null,n=null,r=this;if(r.getSelection)a=r.getSelection().anchorNode,i=""+r.getSelection(),n=r.getSelection(),n.isCollapsed?n.isCollapsed&&a&&(a=a.parentNode):"#text"!==n.focusNode.nodeName?a=n.focusOffset-n.anchorOffset>1?n.anchorNode:"#text"===n.anchorNode.nodeName?n.focusNode:"#text"!==n.anchorNode.childNodes[n.anchorOffset].nodeName?n.anchorNode.childNodes[n.anchorOffset]:n.anchorNode:n.anchorNode.data===n.focusNode.data?e("Selected non bounding text",a=n.anchorNode.parentNode):0!==n.anchorOffset||n.anchorNode.data?n.anchorNode.data!==void 0&&0===n.anchorOffset&&n.anchorOffset<n.anchorNode.data.length?e("Selected whole element at start of paragraph",a=n.anchorNode.parentNode):n.anchorNode.data!==void 0&&n.anchorOffset<n.anchorNode.data.length?e("Selected preceeding element text",a=n.anchorNode.parentNode):n.anchorNode.data!==void 0&&n.anchorOffset===n.anchorNode.data.length&&0===n.focusOffset?e("Selected whole element text",a=n.anchorNode.nextSibling||n.focusNode.previousSibling):n.focusOffset>0&&e("Selected suceeding element text",a=n.focusNode.parentNode):e("Selected whole element at start of paragraph (whereby selected element has not text e.g. &lt;script&gt;",a=n.anchorNode);else{if(!r.document.selection)throw"Error";n=r.document.selection.createRange(),a=n,a=n.parentElement?n.parentElement():n.item(0),i=n.text||n,i.toString&&(i=""+i)}return a&&"#text"===a.nodeName&&(a=a.parentNode),a&&void 0!==a.tagName?(t={obj:a,text:i},void 0):!1}),t};var c={bold:{css:{fontWeight:"bold"},tag:"B|STRONG"},italic:{css:{fontStyle:"italic"},tag:"I|EM"},underline:{css:{textDecoration:"underline"},tag:"U"},strikethrough:{css:{textDecoration:"line-through"},tag:"STRIKE"},justifyright:{css:{textAlign:"right"},attr:{align:"right"}},justifycenter:{css:{textAlign:"center"}},attr:{align:"center"},justifyfull:{css:{textAlign:"justify"}},justifyleft:{css:{textAlign:"left"},attr:{align:"left"}},insertorderedlist:{tag:"OL"},createlink:{tag:"A"},insertimage:{tag:"IMG"},insertunorderedlist:{tag:"UL"},fontname:{css:{fontFamily:null},attr:{face:null}},formatblock:{tag:"ADDRESS|P|PRE|H[0-9]|BLOCKQUOTE"}};t.fn.editor=function(){var i="textarea[type=html], [contenteditable=true]";return(t(this).is(i)?t(this):t(i,this)).each(function(){var i=t(this),n=t(this).outerWidth(),d=t(this).outerHeight();if(t(this).is("textarea")){i=t.make("div[contenteditable=true]").width(n).height(d).attr("style",t(this).attr("style")||"").html(t(this).html()||"").insertAfter(this);var h=t(this).addClass("source");n=t(this).outerWidth(),h.hide(),t(this).add(i).bind("change",function(){t(this).is(":visible")&&(this===h.get(0)?i.html(h.val()):h.val(i.html()))})}var u=t(t(this).attr("data-controls")||"");0===u.length&&(u=t.make(s).html(a()).width(n).insertBefore(this)),i.addClass("editor").bind("click keyup blur",function(e){if("click"!==e.type&&t(this).trigger("change"),"blur"!==e.type){var a=t(window).selectedText().obj;if(a){var i={},n=function(){if(this.tagName){var t,e,a,n=this.tagName.toUpperCase();if("BODY"!==n&&"HTML"!==n)for(t in c)if(!i[t]){for(e in c[t].css)this.style[e]&&(this.style[e].match(c[t].css[e],"i")||null===c[t].css[e]&&this.style[e].length>0)&&(i[t]=this.style[e]);for(e in c[t].attr)this.getAttribute&&(this.getAttribute(e)===c[t].attr[e]||null===c[t].attr[e]&&this.getAttribute(e).length>0)&&(i[t]=this.getAttribute(e));i[t]||null!==(a=n.match("^("+c[t].tag+")$"))&&(i[t]=a[0].toLowerCase())}}};t(a).each(n).parents().each(n),u.find(":input[data-cmd]").each(function(){var e=t(this).attr("data-cmd"),a=i[e]===void 0;"BUTTON"===this.tagName&&(a?t(this).removeClass("selected"):t(this).addClass("selected")),"SELECT"===this.tagName&&(a?this.selectedIndex=0:this.value=i[e])});try{var r=document.selection.createRange().duplicate().getBoundingClientRect();window.posx=r.left,window.posy=r.top}catch(e){}}}}).bind("dragover",function(){return!1}).bind("drop",function(t){return t=(t&&t.originalEvent?t.originalEvent:window.event)||t,t.preventDefault&&t.preventDefault(),r(t.files?t:t.dataTransfer),!1}).on("drag",function(a){if(a.target===this)return!1;if("target"in a&&"elementFromPoint"in document){var i=document.elementFromPoint(a.originalEvent.clientX,a.originalEvent.clientY);t(i).filter(function(){return t(this).filter("[contenteditable]").length||t(this).parents("[contenteditable]").length}).length&&i!==a.target&&(e("landing",a.target,i),"li"===a.target.tagName.toLowerCase()&&-1==="li,ul".split(".").indexOf(i.tagName.toLowerCase()),a.target.tagName.toLowerCase()===i.tagName.toLowerCase()&&"p,li".split(",").indexOf(i.tagName.toLowerCase())>-1||"img"===i.tagName.toLowerCase()?t(a.target).detach().insertBefore(i):t(a.target).detach().prependTo(i))}}),t("button[data-cmd]").on("click",l),t("select[data-cmd]").on("change",o)})},document.onpaste=function(t){return!r(t.clipboardData)}})(jQuery);